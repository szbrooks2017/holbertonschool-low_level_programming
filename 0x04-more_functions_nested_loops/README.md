more nested loops, will edit later
